<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUMA</title>
<link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --void: #0A0A0F; --void-deep: #101018; --void-border: #2E2E44;
  --tungsten: #D4A853; --tungsten-bright: #E8C468; --tungsten-dim: #A07D38;
  --tungsten-glow: rgba(212,168,83,0.15);
  --text-p: #E8E4DD; --text-s: #A8A4A0; --text-m: #686460;
  --grad: linear-gradient(90deg, #E8453C, #F28C38, #E8B84B, #F0D850, #A8D848, #48B878, #38A8A8, #38B8E8, #3878D8, #5848C8, #8838B8, #C838A8);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;-webkit-font-smoothing:antialiased}
body{font-family:'Rubik',sans-serif;background:var(--void);color:var(--text-p);min-height:100vh;line-height:1.6;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 15% 8%,rgba(232,69,60,0.04) 0%,transparent 50%),radial-gradient(ellipse at 40% 15%,rgba(242,140,56,0.03) 0%,transparent 45%),radial-gradient(ellipse at 60% 10%,rgba(240,216,80,0.025) 0%,transparent 40%),radial-gradient(ellipse at 80% 20%,rgba(72,184,120,0.03) 0%,transparent 45%),radial-gradient(ellipse at 20% 85%,rgba(56,120,216,0.035) 0%,transparent 50%),radial-gradient(ellipse at 50% 90%,rgba(88,72,200,0.04) 0%,transparent 45%),radial-gradient(ellipse at 80% 85%,rgba(136,56,184,0.03) 0%,transparent 40%);pointer-events:none;z-index:0}

nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:20px 40px;display:flex;justify-content:space-between;align-items:center;background:rgba(10,10,15,0.85);backdrop-filter:blur(12px);border-bottom:1px solid transparent;transition:border-color 0.3s, opacity 0.5s, transform 0.5s;opacity:0;transform:translateY(-100%);pointer-events:none}
nav.visible{opacity:1;transform:translateY(0);pointer-events:auto}
nav.scrolled{border-bottom-color:var(--void-border)}
.nav-mark{display:flex;align-items:center;gap:16px;text-decoration:none}
.nav-wordmark{opacity:0;transition:opacity 0.3s}
nav.scrolled .nav-wordmark{opacity:1}
.nav-links{display:flex;gap:32px;list-style:none}
.nav-links a{color:var(--text-s);text-decoration:none;font-size:13px;font-weight:500;letter-spacing:0.04em;transition:color 0.2s}
.nav-links a:hover{color:var(--tungsten)}

.hero{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:80px 40px;position:fixed;inset:0;z-index:10;transition:opacity 0.8s ease;background:var(--void)}
.hero.dissolved{opacity:0;pointer-events:none}
.hero-mark{margin-bottom:48px;opacity:0;animation:fadeIn 1.2s ease 0.3s forwards}
.hero-wordmark{margin-bottom:40px;opacity:0;animation:fadeIn 1.2s ease 0.6s forwards}
.spectrum-line-hero{height:2px;width:100%;max-width:480px;background:linear-gradient(90deg, transparent, var(--tungsten-dim), var(--tungsten), var(--tungsten-dim), transparent);margin-bottom:48px;opacity:0;animation:fadeIn 1.2s ease 0.9s forwards}
.hero-claim{font-size:20px;font-weight:400;line-height:1.7;color:var(--text-s);max-width:480px;opacity:0;animation:fadeUp 1s ease 1.2s forwards}
.hero-tap{display:block;margin-top:24px;font-size:13px;color:var(--tungsten);letter-spacing:0.12em;text-transform:uppercase;font-family:'DM Mono',monospace}
.hero-cta{cursor:pointer}
.hero-mark svg{animation:heroGlow 3s ease-in-out 2.5s infinite}
@keyframes heroGlow{0%,100%{filter:brightness(0.7);opacity:0.7}50%{filter:brightness(1.4);opacity:1}}

.well{padding:60px 40px 40px;max-width:640px;margin:0 auto;position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column;justify-content:center;opacity:0;transition:opacity 0.8s ease 0.4s}
.well.visible{opacity:1}
.well-mark{text-align:center;margin-bottom:32px}
.well-mark svg{animation:heroGlow 3s ease-in-out infinite}
.well-intro{font-size:20px;color:var(--text-s);text-align:center;margin-bottom:64px;line-height:1.7}

.question-step{display:none}
.question-step.active{display:block;animation:fadeUp 0.5s ease forwards}
.question-number{font-size:11px;font-family:'DM Mono',monospace;color:var(--void-border);letter-spacing:0.06em;margin-bottom:20px}
.question-text{font-size:24px;font-weight:400;line-height:1.55;color:var(--text-p);margin-bottom:32px}
.question-input{width:100%;min-height:140px;padding:24px;background:transparent;border:1px solid var(--void-border);color:var(--text-p);font-family:'Rubik',sans-serif;font-size:15px;line-height:1.7;resize:vertical;outline:none;transition:border-color 0.3s}
.question-input::placeholder{color:var(--text-m);font-style:italic}
.question-input:focus{border-color:var(--tungsten-dim)}
.question-nav{display:flex;justify-content:flex-end;margin-top:20px}

.btn{padding:10px 20px;background:transparent;border:1px solid var(--void-border);color:var(--text-m);font-family:'Rubik',sans-serif;font-size:13px;cursor:pointer;transition:all 0.2s}
.btn:hover{border-color:var(--tungsten-dim);color:var(--text-s)}
.btn-p{padding:10px 20px;background:transparent;border:1px solid var(--tungsten-dim);color:var(--tungsten);font-family:'Rubik',sans-serif;font-size:13px;cursor:pointer;transition:all 0.2s}
.btn-p:hover{border-color:var(--tungsten);color:var(--tungsten-bright)}

.phase{display:none}
.phase.active{display:block;animation:fadeUp 0.6s ease forwards}

.reflecting-text{text-align:center;color:var(--text-m);font-size:15px;font-style:italic;padding:40px 0}

.reflection-text{font-size:16px;color:var(--text-s);line-height:1.9;margin-bottom:20px}
.reflection-content{cursor:text;margin-bottom:40px}

.contact-question{font-size:18px;font-weight:400;line-height:1.55;color:var(--text-p);margin-bottom:24px;text-align:center}
.contact-methods{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;margin-bottom:32px}
.method-btn{padding:8px 16px;background:transparent;border:1px solid var(--void-border);color:var(--text-m);font-family:'Rubik',sans-serif;font-size:13px;cursor:pointer;transition:all 0.2s}
.method-btn:hover{border-color:var(--tungsten-dim);color:var(--text-s)}
.contact-input{width:100%;padding:16px 20px;background:transparent;border:1px solid var(--void-border);color:var(--text-p);font-family:'Rubik',sans-serif;font-size:15px;outline:none;transition:border-color 0.3s}
.contact-input:focus{border-color:var(--tungsten-dim)}
.contact-input::placeholder{color:var(--text-m);font-style:italic}

.note{font-size:12px;color:var(--text-m);font-family:'DM Mono',monospace;text-align:center;letter-spacing:0.03em}
.spectrum-line{height:1px;background:linear-gradient(90deg, transparent, var(--tungsten-dim), var(--tungsten), var(--tungsten-dim), transparent);max-width:640px;margin:0 auto}
.divider{height:1px;margin:48px 0;background:var(--grad)}

.bridge{padding:80px 40px;max-width:640px;margin:0 auto;text-align:center;position:relative;z-index:1}
.bridge p{font-size:16px;color:var(--text-m);line-height:1.85;margin-bottom:24px}
.bridge-link{color:var(--tungsten);text-decoration:none;font-size:14px;font-weight:500;letter-spacing:0.03em;border-bottom:1px solid var(--tungsten-dim);padding-bottom:2px;transition:all 0.2s}
.bridge-link:hover{color:var(--tungsten-bright);border-bottom-color:var(--tungsten-bright)}

footer{border-top:1px solid;border-image:var(--grad) 1;padding:48px 40px;text-align:center;position:relative;z-index:1}
.footer-mark{margin-bottom:24px}
.footer-links{display:flex;justify-content:center;gap:32px;list-style:none;margin-bottom:32px}
.footer-links a{color:var(--text-m);text-decoration:none;font-size:13px;font-weight:400;letter-spacing:0.04em;transition:color 0.2s}
.footer-links a:hover{color:var(--tungsten)}
.footer-copy{font-size:11px;color:var(--text-m);font-family:'DM Mono',monospace}

.done-text{font-size:16px;color:var(--text-s);line-height:1.8;text-align:center}

@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:0.3}50%{opacity:0.8}}

@media(max-width:768px){nav{padding:16px 20px}.hero{padding:80px 24px}.well{padding:80px 24px 40px}.question-text{font-size:20px}.bridge{padding:60px 24px}}
@media(max-width:480px){.nav-links{display:none}.question-text{font-size:18px}}
</style>
</head>
<body>


<div class="hero">
  <div class="hero-cta" onclick="beginReflection()">
    <div class="hero-mark">
      <svg width="120" height="120" viewBox="0 0 200 200" fill="none"><path d="M10 10L10 190L190 190L190 10L10 10" stroke="#D4A853" stroke-width="5" fill="none" stroke-linecap="square"/><path d="M38 50L38 162L162 162L162 50" stroke="#D4A853" stroke-width="4.5" fill="none" stroke-linecap="square"/><path d="M66 66L66 134L134 134L134 66L114 66" stroke="#D4A853" stroke-width="4" fill="none" stroke-linecap="square"/><path d="M86 66L66 66" stroke="#D4A853" stroke-width="4" stroke-linecap="square"/><rect x="88" y="88" width="24" height="24" fill="#D4A853"/></svg>
    </div>
    <div class="hero-wordmark">
      <svg width="280" height="56" viewBox="0 0 720 160" fill="none"><path d="M20 12L20 148L136 148" stroke="#D4A853" stroke-width="11" stroke-linecap="square"/><path d="M172 12L172 148L296 148L296 12" stroke="#D4A853" stroke-width="11" stroke-linecap="square"/><path d="M332 148L332 12L400 12L400 40" stroke="#D4A853" stroke-width="11" stroke-linecap="square"/><path d="M424 40L424 12L492 12L492 148" stroke="#D4A853" stroke-width="11" stroke-linecap="square"/><path d="M528 148L528 12L652 12L652 148" stroke="#D4A853" stroke-width="11" stroke-linecap="square"/><path d="M528 80L652 80" stroke="#D4A853" stroke-width="11" stroke-linecap="square"/></svg>
    </div>
    <div class="spectrum-line-hero"></div>
    <p class="hero-claim">When is the last time you were asked a question you didn&rsquo;t have an immediate answer for?<span class="hero-tap">Tap to begin</span></p>
  </div>
</div>

<div class="well" id="well">
  <div class="well-mark" id="well-mark">
    <svg width="120" height="120" viewBox="0 0 200 200" fill="none"><path d="M10 10L10 190L190 190L190 10L10 10" stroke="#D4A853" stroke-width="5" fill="none" stroke-linecap="square"/><path d="M38 50L38 162L162 162L162 50" stroke="#D4A853" stroke-width="4.5" fill="none" stroke-linecap="square"/><path d="M66 66L66 134L134 134L134 66L114 66" stroke="#D4A853" stroke-width="4" fill="none" stroke-linecap="square"/><path d="M86 66L66 66" stroke="#D4A853" stroke-width="4" stroke-linecap="square"/><rect x="88" y="88" width="24" height="24" fill="#D4A853"/></svg>
  </div>
  <p class="well-intro" id="well-intro">Here are three questions.<br><span style="display:inline-block;margin-top:8px">Sit with them for as long as you&rsquo;d like.</span><br><span style="display:inline-block;margin-top:8px">The more honesty, the clearer the reflection.</span></p>
  <!-- Questions -->
  <div class="question-step active" id="step-0">
    <div class="question-number">01</div>
    <div class="question-text" id="q-0"></div>
    <textarea class="question-input" id="a-0" placeholder="Take your time."></textarea>
    <div class="question-nav"><button class="btn" onclick="nextStep(1)">Next</button></div>
  </div>
  <div class="question-step" id="step-1">
    <div class="question-number">02</div>
    <div class="question-text" id="q-1"></div>
    <textarea class="question-input" id="a-1" placeholder="Take your time."></textarea>
    <div class="question-nav"><button class="btn" onclick="nextStep(2)">Next</button></div>
  </div>
  <div class="question-step" id="step-2">
    <div class="question-number">03</div>
    <div class="question-text" id="q-2"></div>
    <textarea class="question-input" id="a-2" placeholder="Take your time."></textarea>
    <div class="question-nav"><button class="btn-p" onclick="getReflection()">Show me</button></div>
  </div>

  <!-- Loading -->
  <div class="phase" id="loading-phase">
    <p class="reflecting-text">Reflecting...</p>
  </div>

  <!-- Reflection -->
  <div class="phase" id="reflection-phase">
    <div class="reflection-content" id="reflection-content" onclick="selectReflection()"></div>

    <!-- Contact — directly below reflection -->
    <div id="contact-area">
      <p class="contact-question">Want to keep going?</p>
      <div class="contact-methods" id="method-buttons">
        <button class="method-btn" onclick="pickMethod('email')">Email</button>
        <button class="method-btn" onclick="pickMethod('phone')">Phone</button>
        <button class="method-btn" onclick="pickMethod('text')">Text</button>
        <button class="method-btn" onclick="pickMethod('other')">Other</button>
      </div>
      <div id="contact-form" style="display:none">
        <p class="note" id="contact-label" style="margin-bottom:16px"></p>
        <input class="contact-input" id="contact-info" type="text" placeholder="">
        <div style="display:flex;justify-content:flex-end;margin-top:16px;gap:12px">
          <button class="btn" onclick="resetContact()">Back</button>
          <button class="btn-p" onclick="submitContact()">Send</button>
        </div>
        <p class="note" style="margin-top:24px;font-size:11px">This is the only moment anything is saved. Your questions, answers, reflection, and how to reach you &mdash; sent together.</p>
      </div>
    </div>

    <!-- Submitted state -->
    <div id="submitted-area" style="display:none">
      <p class="done-text">Got it. I&rsquo;ll be in touch the way you asked.</p>
      <p class="note" style="margin-top:16px">&mdash; Patrick</p>
    </div>

    <!-- Footer utilities -->
    <div class="divider"></div>
    <p class="note" style="margin-bottom:20px">Nothing you wrote is stored by LUMA.</p>
    <div style="display:flex;justify-content:center;gap:16px">
      <button class="btn" onclick="copyReflection()">Copy</button>
      <button class="btn-p" onclick="downloadMd()">Download .md</button>
    </div>
  </div>
</div>

<div class="spectrum-line" id="post-reflection" style="display:none"></div>

<div class="bridge" id="bridge" style="display:none">
  <p>That was the surface. Three questions, a quick draw. The full version is a sixty-minute conversation and seven trained perspectives, all listening to the same material.</p>
</div>

<footer id="footer" style="display:none">
  <ul class="footer-links">
    <li><a href="/prism">The Prism</a></li>
    <li><a href="/approach">Approach</a></li>
    <li><a href="/about">About</a></li>
  </ul>
  <p class="footer-copy">&copy; 2026 LUMA LLC</p>
</footer>

<script>
// ---- CONFIG ----
// In production, this points to your Cloudflare Worker
const API_BASE = "https://luma-reflection.lumampls.workers.dev";

// ---- DISSOLVE ----
function beginReflection() {
  document.querySelector(".hero").classList.add("dissolved");
  document.getElementById("well").classList.add("visible");
  window.scrollTo(0, 0);
  setTimeout(() => document.getElementById("a-0").focus(), 900);
}

// ---- STATE ----
let well = [];
let questions = [];
let answers = ["", "", ""];
let currentStep = 0;
let reflectionText = "";
let contactMethod = null;

// ---- INIT ----
fetch("well.json")
  .then(r => r.json())
  .then(data => {
    well = data;
    questions = drawThree();
    document.getElementById("q-0").textContent = questions[0];
    document.getElementById("q-1").textContent = questions[1];
    document.getElementById("q-2").textContent = questions[2];
  });

function drawThree() {
  const idx = [];
  while (idx.length < 3) {
    const i = Math.floor(Math.random() * well.length);
    if (!idx.includes(i)) idx.push(i);
  }
  return idx.map(i => well[i]);
}

// ---- QUESTIONS ----
function nextStep(step) {
  const ta = document.getElementById("a-" + currentStep);
  answers[currentStep] = ta.value;
  if (!ta.value.trim()) { ta.focus(); return; }

  document.getElementById("step-" + currentStep).classList.remove("active");
  document.getElementById("step-" + step).classList.add("active");
  currentStep = step;

  document.getElementById("well").scrollIntoView({ behavior: "smooth", block: "start" });
  setTimeout(() => document.getElementById("a-" + step).focus(), 400);
}

// ---- REFLECTION ----
async function getReflection() {
  const ta = document.getElementById("a-" + currentStep);
  answers[currentStep] = ta.value;
  if (!ta.value.trim()) { ta.focus(); return; }

  // Hide question, show reflecting state
  document.getElementById("step-" + currentStep).classList.remove("active");
  document.getElementById("well-intro").style.display = "none";
  document.getElementById("loading-phase").classList.add("active");
  document.getElementById("well").scrollIntoView({ behavior: "smooth", block: "start" });

  try {
    const res = await fetch(API_BASE + "/api/reflect", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ questions, answers })
    });
    const data = await res.json();
    reflectionText = data.reflection || "Something went still. The reflection couldn't form this time.";
  } catch (err) {
    reflectionText = "Something went still. The reflection couldn't form this time.";
  }

  // Render reflection
  const container = document.getElementById("reflection-content");
  container.innerHTML = "";
  reflectionText.split("\n\n").forEach(p => {
    const el = document.createElement("p");
    el.className = "reflection-text";
    el.textContent = p;
    container.appendChild(el);
  });

  document.getElementById("loading-phase").classList.remove("active");
  document.getElementById("reflection-phase").classList.add("active");
  document.getElementById("post-reflection").style.display = "";
  document.getElementById("bridge").style.display = "";
  document.getElementById("footer").style.display = "";
  document.getElementById("reflection-phase").scrollIntoView({ behavior: "smooth", block: "start" });
}

// ---- CONTACT ----
const labels = { email: "What's your email?", phone: "What's your number?", text: "What's your number?", other: "Where should I find you?" };
const placeholders = { email: "you@example.com", phone: "555-555-5555", text: "555-555-5555", other: "Instagram, LinkedIn, carrier pigeon..." };

function pickMethod(method) {
  contactMethod = method;
  document.getElementById("method-buttons").style.display = "none";
  document.getElementById("contact-label").textContent = labels[method];
  document.getElementById("contact-info").type = method === "email" ? "email" : "text";
  document.getElementById("contact-info").placeholder = placeholders[method];
  document.getElementById("contact-form").style.display = "block";
  setTimeout(() => document.getElementById("contact-info").focus(), 100);
}

function resetContact() {
  contactMethod = null;
  document.getElementById("contact-form").style.display = "none";
  document.getElementById("method-buttons").style.display = "flex";
  document.getElementById("contact-info").value = "";
}

async function submitContact() {
  const info = document.getElementById("contact-info").value.trim();
  if (!info) { document.getElementById("contact-info").focus(); return; }

  const payload = {
    q1: questions[0], a1: answers[0],
    q2: questions[1], a2: answers[1],
    q3: questions[2], a3: answers[2],
    reflection: reflectionText,
    contact_method: contactMethod,
    contact_info: info
  };

  try {
    await fetch(API_BASE + "/api/contact", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  } catch (err) {
    // Silent fail — don't punish the user for a backend hiccup
  }

  document.getElementById("contact-area").style.display = "none";
  document.getElementById("submitted-area").style.display = "block";
}

// ---- UTILITIES ----
function selectReflection() {
  const el = document.getElementById("reflection-content");
  const r = document.createRange(); r.selectNodeContents(el);
  const s = window.getSelection(); s.removeAllRanges(); s.addRange(r);
}

function copyReflection() {
  const el = document.getElementById("reflection-content");
  navigator.clipboard.writeText(el.innerText).catch(() => {
    selectReflection();
    document.execCommand("copy");
    window.getSelection().removeAllRanges();
  });
}

function downloadMd() {
  const md = "# A Reflection\n\n---\n\n"
    + "**" + questions[0] + "**\n\n" + answers[0] + "\n\n"
    + "**" + questions[1] + "**\n\n" + answers[1] + "\n\n"
    + "**" + questions[2] + "**\n\n" + answers[2] + "\n\n"
    + "---\n\n" + reflectionText + "\n\n---\n\n*LUMA*\n";
  const blob = new Blob([md], { type: "text/markdown" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href = url; a.download = "reflection.md"; a.click();
  URL.revokeObjectURL(url);
}

// ---- NAV ----
window.addEventListener("scroll", () => {
  const nav = document.getElementById("nav");
  if (nav.classList.contains("visible")) {
    nav.classList.toggle("scrolled", window.scrollY > 80);
  }
});

// ---- ENTER KEY ----
document.querySelectorAll(".question-input").forEach((ta, i) => {
  ta.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      if (i < 2) nextStep(i + 1);
      else getReflection();
    }
  });
});

document.getElementById("contact-info").addEventListener("keydown", e => {
  if (e.key === "Enter") { e.preventDefault(); submitContact(); }
});
</script>
</body>
</html>
